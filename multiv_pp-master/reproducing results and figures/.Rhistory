emos.q <- mvpp(method = "EMOS", variant = "Q", ensfc = ensfc, ensfc_init = ensfc_init,
obs = obs, obs_init = obs_init, postproc_out = pp_out, timeWindow = timeWindow, ecc_m = ecc_m)
for(RR in 1:rand_rep){
start_time <- Sys.time()
ssh <- mvpp(method = "SSh", ensfc = ensfc, ensfc_init = ensfc_init,
obs = obs, obs_init = obs_init, postproc_out = pp_out,
EMOS_sample = emos.q$mvppout, timeWindow = timeWindow, ecc_m = ecc_m)
crps_list_tmp[,,RR] <- crps_wrapper(ssh$mvppout, obs)
tmp <- eval_all_mult(mvpp_out = ssh$mvppout, obs = obs)
es_list_tmp[,RR] <- tmp$es
vs1_list_tmp[,RR] <- tmp$vs1
vs1w_list_tmp[,RR] <- tmp$vs1w
vs0_list_tmp[,RR] <- tmp$vs0
vs0w_list_tmp[,RR] <- tmp$vs0w
end_time <- Sys.time()
timing_list_tmp[RR] <- end_time - start_time
}
crps_list$ssh <- apply(crps_list_tmp, c(1,2), mean)
es_list$ssh <- apply(es_list_tmp, 1, mean)
vs1_list$ssh <- apply(vs1_list_tmp, 1, mean)
vs1w_list$ssh <- apply(vs1w_list_tmp, 1, mean)
vs0_list$ssh <- apply(vs0_list_tmp, 1, mean)
vs0w_list$ssh <- apply(vs0w_list_tmp, 1, mean)
timing_list$ssh <- apply(timing_list_tmp, 1, mean)
mvpp_list$ssh <- ssh$mvppout
print("GCA")
# GCA -> involves randomness -> repeat rand_rep times
es_list_tmp <- vs1_list_tmp <- vs1w_list_tmp <-
vs0_list_tmp <- vs0w_list_tmp <- matrix(NA, nrow = nout, ncol = rand_rep)
crps_list_tmp <- array(NA, dim = c(nout, d, rand_rep))
timing_list_tmp <- array(NA, dim = rand_rep)
for(RR in 1:rand_rep){
start_time <- Sys.time()
gca <- mvpp(method = "GCA", ensfc = ensfc, ensfc_init = ensfc_init,
obs = obs, obs_init = obs_init, postproc_out = pp_out, timeWindow = timeWindow, ecc_m = ecc_m, uvpp = uvpp)
.GlobalEnv$tt <- gca$mvppout
crps_list_tmp[,,RR] <- crps_wrapper(gca$mvppout, obs)
tmp <- eval_all_mult(mvpp_out = gca$mvppout, obs = obs)
es_list_tmp[,RR] <- tmp$es
vs1_list_tmp[,RR] <- tmp$vs1
vs1w_list_tmp[,RR] <- tmp$vs1w
vs0_list_tmp[,RR] <- tmp$vs0
vs0w_list_tmp[,RR] <- tmp$vs0w
end_time <- Sys.time()
timing_list_tmp[RR] <- end_time - start_time
}
crps_list$gca <- apply(crps_list_tmp, c(1,2), mean)
es_list$gca <- apply(es_list_tmp, 1, mean)
vs1_list$gca <- apply(vs1_list_tmp, 1, mean)
vs1w_list$gca <- apply(vs1w_list_tmp, 1, mean)
vs0_list$gca <- apply(vs0_list_tmp, 1, mean)
vs0w_list$gca <- apply(vs0w_list_tmp, 1, mean)
timing_list$gca <- apply(timing_list_tmp, 1, mean)
mvpp_list$gca <- gca$mvppout
# Archimedean copulas -> involves randomness -> repeat rand_rep times
for (method in c("Surv_Gumbel", "Clayton","Frank", "Gumbel")) {
print(method)
start_time <- Sys.time()
mvd <- mvpp(method = method, ensfc = ensfc, ensfc_init = ensfc_init,
obs = obs, obs_init = obs_init, postproc_out = pp_out, timeWindow = timeWindow, ecc_m = ecc_m, uvpp = uvpp)
chosenCopula_list[[method]] <- mvd$chosenCopula
good_rows <- !unname(apply(mvd$mvppout, MARGIN = 1, FUN = function(x) any(is.na(x))))
score_mvppout <- mvd$mvppout[good_rows,,]
score_obs <- obs[good_rows,]
crps_list[[method]][good_rows,] <- crps_wrapper(score_mvppout, score_obs)
tmp <- eval_all_mult(mvpp_out = score_mvppout, obs = score_obs)
es_list[[method]][good_rows] <- tmp$es
vs1_list[[method]][good_rows] <- tmp$vs1
vs1w_list[[method]][good_rows] <- tmp$vs1w
vs0_list[[method]][good_rows] <- tmp$vs0
vs0w_list[[method]][good_rows] <- tmp$vs0w
mvpp_list[[method]] <- mvd$mvppout
end_time <- Sys.time()
timing_list[[method]] <- end_time - start_time
}
# Seasonal copula MVPP
print("Seasonal")
start_time <- Sys.time()
mvd <- seasonal_copula(data, ensfc = ensfc, obs = obs, obs_init = obs_init, postproc_out = pp_out, ecc_m = ecc_m)
good_rows <- !unname(apply(mvd$mvppout, MARGIN = 1, FUN = function(x) any(is.na(x))))
score_mvppout <- mvd$mvppout[good_rows,,]
score_obs <- obs[good_rows,]
crps_list[["Seasonal"]][good_rows,] <- crps_wrapper(score_mvppout, score_obs)
tmp <- eval_all_mult(mvpp_out = score_mvppout, obs = score_obs)
es_list[["Seasonal"]][good_rows] <- tmp$es
vs1_list[["Seasonal"]][good_rows] <- tmp$vs1
vs1w_list[["Seasonal"]][good_rows] <- tmp$vs1w
vs0_list[["Seasonal"]][good_rows] <- tmp$vs0
vs0w_list[["Seasonal"]][good_rows] <- tmp$vs0w
mvpp_list[["Seasonal"]] <- mvd$mvppout
end_time <- Sys.time()
timing_list[["Seasonal"]] <- end_time - start_time
copula_df <- mvd$copula_df
print("Returning Output")
# return results, as a huge list
out <- list("crps_list" = crps_list, "es_list" = es_list, "vs1_list" = vs1_list,
"vs1w_list" = vs1w_list, "vs0_list" = vs0_list, "vs0w_list" = vs0w_list,
"timing_list" = timing_list, "mvpp_list" = mvpp_list, "chosenCopula_list" = chosenCopula_list,
"obs" = obs, "copula_df" = copula_df)
return(out)
}
trainingDays <- 365
saveDir <- "./../Data/Rdata_LAEF/"
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
t[1,,]
anyNA(t[1,,])
anyNA(t[2,,])
anyNA(t[3,,])
anyNA(t[,,1])
anyNA(t[,,2])
anyNA(t[,,3])
anyNA(t[17,,])
anyNA(t[18,,])
for (i in 1:50) {
print(paste0(i,": ", anyNA(t[i,,])))
}
for (i in 1:825) {
print(paste0(i,": ", anyNA(t[i,,])))
}
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
a <- c(1,2,3)
a[1]
a[2]
a[3]
a[4]
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
rnorm(n = 50, mean = 264.0843, sd = 2.743751)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
anyNA(t)
rm(t)
rm(tt)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
anyNA(t)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/simulation code/sourceArchimedean/mvpp_arch.R")
eval_all_mult <- function(mvpp_out, obs){
esout <- es_wrapper(mvpp_out, obs)
vs1out <- vs_wrapper(mvpp_out, obs, weight = FALSE, p = 1)
vs1wout <- vs_wrapper(mvpp_out, obs, weight = TRUE, p = 1)
vs0out <- vs_wrapper(mvpp_out, obs, weight = FALSE, p = 0.5)
vs0wout <- vs_wrapper(mvpp_out, obs, weight = TRUE, p = 0.5)
return(list("es" = esout, "vs1" = vs1out, "vs1w" = vs1wout, "vs0" = vs0out, "vs0w" = vs0wout))
}
run_processing <- function(data, trainingDays, progress_ind = FALSE, ...){
# Use same time window as training days for UVPP
timeWindow <- 30
# Stations and days from the data
stations <- unique(data$stat)
days <- sort(unique(data$td))
nout <- length(days) - trainingDays
# 1 weather variable over 1 lead time with d stations
d <- length(stations)
# Ensemble members
m <- sum(grepl("laef", names(data)))
ecc_m <- 50
ensembleMembers <- sapply(1:m, FUN = function(x) paste0("laef", x))
# generate objects to save scores to
modelnames <- c("ens", "emos.q", "ecc.q", "ecc.s", "decc.q", "ssh", "gca","Clayton","Frank","Gumbel", "Surv_Gumbel", "Seasonal")
crps_list <- es_list <- vs1_list <- vs1w_list <- vs0_list <- vs0w_list <- mvpp_list <- chosenCopula_list <- list()
# Timing_list stores the time needed to do all relevant computations
timing_list <- list()
for(mm in 1:length(modelnames)){
es_list[[mm]] <- vs1_list[[mm]] <- vs1w_list[[mm]] <-
vs0_list[[mm]] <- vs0w_list[[mm]] <- matrix(NA, nrow = 1, ncol = nout)
crps_list[[mm]] <- array(NA, dim = c(nout, d))
timing_list[[mm]] <- chosenCopula_list[[mm]] <- array(NA, dim = 1)
}
names(crps_list) <- names(es_list) <- names(vs1_list) <- names(vs1w_list) <-
names(vs0_list) <- names(vs0w_list) <- names(timing_list) <- names(chosenCopula_list) <- modelnames
# set random seed
set.seed(1)
# Create ensfc and obs data structure
ensfc_init <- array(NA, dim = c(trainingDays, m, d))
ensfc <- array(NA, dim = c(nout, m, d))
obs_init <- array(NA, dim = c(trainingDays, d))
obs <- array(NA, dim = c(nout, d))
# Dimension only consists of stations
for (station in stations) {
# Element of 1..d
index <- match(station,stations)
# Reformat days to be in 1..days
for (day in 1:length(days)) {
# Extract forecast for day and dim = index
tryCatch(
{
dat <- subset(data, td == days[day] & stat == station)
if (day <= trainingDays) {
ensfc_init[day,,index] <- unlist(dat[ensembleMembers], use.names = FALSE)
obs_init[day, index] <- unlist(dat["obs"], use.names = FALSE)
} else{
ensfc[day - trainingDays,,index] <- unlist(dat[ensembleMembers], use.names = FALSE)
obs[day - trainingDays, index] <- unlist(dat["obs"], use.names = FALSE)
}
}
,
error = function(cond) {
print(cond)
}
)
}
}
print("Start UVPP")
# Start UVPP
start_time <- Sys.time()
uvpp <- list()
for (station in stations) {
statIndex <- match(station,stations)
emos.result <- emos_T2M_mean_singleForecast(subset(data, stat == station), trainingDays)
emos.result$stat <- statIndex
uvpp <- rbind(uvpp, emos.result)
}
# .GlobalEnv$uvpp <- uvpp
end_time <- Sys.time()
timing_list$uvpp <- end_time - start_time
print("Start MVPP")
## Start MVPP
start_time <- Sys.time()
dat <- uvpp[c("crps_emos", "stat")]
# Create pp_out data structure and fill crps scores
pp_out <- array(NA, dim = c(nout, d, 2))
for (station in stations) {
# Element of 1..d
index <- match(station,stations)
# Reformat days to be in 1..days
for (day in (trainingDays+1):length(days)) {
tryCatch(
{
temp <- subset(uvpp, td == days[day] & stat == index)
crps_list$ens[day - trainingDays, index] <- unlist(unname(temp["crps_emos"]))
pp_out[day - trainingDays, index, ] <- unlist(unname(temp[c("ens_mu", "ens_sd")]))
}
,
error = function(cond) {
print(cond)
})
}
}
tmp <- eval_all_mult(mvpp_out = ensfc, obs = obs)
es_list$ens <- tmp$es
vs1_list$ens <- tmp$vs1
vs1w_list$ens <- tmp$vs1w
vs0_list$ens <- tmp$vs0
vs0w_list$ens <- tmp$vs0w
.GlobalEnv$uvpp <- uvpp
.GlobalEnv$pp_out <- pp_out
.GlobalEnv$obs_init <- obs_init
.GlobalEnv$obs <- obs
.GlobalEnv$ensfc_init <- ensfc_init
.GlobalEnv$ensfc <- ensfc
mvpp_list$ens <- ensfc
print("EMOS.Q")
# EMOS.Q
start_time <- Sys.time()
emos.q <- mvpp(method = "EMOS", variant = "Q", ensfc = ensfc, ensfc_init = ensfc_init,
obs = obs, obs_init = obs_init, postproc_out = pp_out, timeWindow = timeWindow, ecc_m = m)
crps_list$emos.q <- crps_wrapper(emos.q$mvppout, obs)
tmp <- eval_all_mult(mvpp_out = emos.q$mvppout, obs = obs)
es_list$emos.q <- tmp$es
vs1_list$emos.q <- tmp$vs1
vs1w_list$emos.q <- tmp$vs1w
vs0_list$emos.q <- tmp$vs0
vs0w_list$emos.q <- tmp$vs0w
end_time <- Sys.time()
timing_list$emos.q <- end_time - start_time
mvpp_list$emos.q <- emos.q$mvppout
print("ECC.Q")
# ECC.Q
start_time <- Sys.time()
ecc.q <- mvpp(method = "ECC", ensfc = ensfc, ensfc_init = ensfc_init,
obs = obs, obs_init = obs_init, postproc_out = pp_out,
EMOS_sample = emos.q$mvppout, timeWindow = timeWindow)
crps_list$ecc.q <- crps_wrapper(ecc.q$mvppout, obs)
tmp <- eval_all_mult(mvpp_out = ecc.q$mvppout, obs = obs)
es_list$ecc.q <- tmp$es
vs1_list$ecc.q <- tmp$vs1
vs1w_list$ecc.q <- tmp$vs1w
vs0_list$ecc.q <- tmp$vs0
vs0w_list$ecc.q <- tmp$vs0w
end_time <- Sys.time()
timing_list$ecc.q <- end_time - start_time
mvpp_list$ecc.q <- ecc.q$mvppout
rand_rep <- 1
print("ECC.S")
# ECC.S -> involves randomness
es_list_tmp <- vs1_list_tmp <- vs1w_list_tmp <-
vs0_list_tmp <- vs0w_list_tmp <- matrix(NA, nrow = nout, ncol = rand_rep)
crps_list_tmp <- array(NA, dim = c(nout, d, rand_rep))
timing_list_tmp <- array(NA, dim = rand_rep)
for(RR in 1:rand_rep){
start_time <- Sys.time()
emos.s <- mvpp(method = "EMOS", variant = "S", ensfc = ensfc, ensfc_init = ensfc_init,
obs = obs, obs_init = obs_init, postproc_out = pp_out, timeWindow = timeWindow, ecc_m = m)
ecc.s <- mvpp(method = "ECC", ensfc = ensfc, ensfc_init = ensfc_init,
obs = obs, obs_init = obs_init, postproc_out = pp_out,
EMOS_sample = emos.s$mvppout, timeWindow = timeWindow)
crps_list_tmp[,,RR] <- crps_wrapper(ecc.s$mvppout, obs)
tmp <- eval_all_mult(mvpp_out = ecc.s$mvppout, obs = obs)
es_list_tmp[,RR] <- tmp$es
vs1_list_tmp[,RR] <- tmp$vs1
vs1w_list_tmp[,RR] <- tmp$vs1w
vs0_list_tmp[,RR] <- tmp$vs0
vs0w_list_tmp[,RR] <- tmp$vs0w
end_time <- Sys.time()
timing_list_tmp[RR] <- end_time - start_time
}
crps_list$ecc.s <- apply(crps_list_tmp, c(1,2), mean)
es_list$ecc.s <- apply(es_list_tmp, 1, mean)
vs1_list$ecc.s <- apply(vs1_list_tmp, 1, mean)
vs1w_list$ecc.s <- apply(vs1w_list_tmp, 1, mean)
vs0_list$ecc.s <- apply(vs0_list_tmp, 1, mean)
vs0w_list$ecc.s <- apply(vs0w_list_tmp, 1, mean)
timing_list$ecc.s <- apply(timing_list_tmp, 1, mean)
mvpp_list$ecc.s <- ecc.s$mvppout
print("dECC.Q")
# dECC.Q
start_time <- Sys.time()
decc.q <- mvpp(method = "dECC", ensfc = ensfc, ensfc_init = ensfc_init,
obs = obs, obs_init = obs_init, postproc_out = pp_out,
EMOS_sample = emos.q$mvppout, ECC_out = ecc.q$mvppout, timeWindow = timeWindow)
crps_list$decc.q <- crps_wrapper(decc.q$mvppout, obs)
tmp <- eval_all_mult(mvpp_out = decc.q$mvppout, obs = obs)
es_list$decc.q <- tmp$es
vs1_list$decc.q <- tmp$vs1
vs1w_list$decc.q <- tmp$vs1w
vs0_list$decc.q <- tmp$vs0
vs0w_list$decc.q <- tmp$vs0w
end_time <- Sys.time()
timing_list$decc.q <- end_time - start_time
mvpp_list$decc.q <- decc.q$mvppout
print("SSh")
# SSh -> involves randomness -> repeat rand_rep times
es_list_tmp <- vs1_list_tmp <- vs1w_list_tmp <-
vs0_list_tmp <- vs0w_list_tmp <- matrix(NA, nrow = nout, ncol = rand_rep)
crps_list_tmp <- array(NA, dim = c(nout, d, rand_rep))
timing_list_tmp <- array(NA, dim = rand_rep)
# EMOS.Q with different m
emos.q <- mvpp(method = "EMOS", variant = "Q", ensfc = ensfc, ensfc_init = ensfc_init,
obs = obs, obs_init = obs_init, postproc_out = pp_out, timeWindow = timeWindow, ecc_m = ecc_m)
for(RR in 1:rand_rep){
start_time <- Sys.time()
ssh <- mvpp(method = "SSh", ensfc = ensfc, ensfc_init = ensfc_init,
obs = obs, obs_init = obs_init, postproc_out = pp_out,
EMOS_sample = emos.q$mvppout, timeWindow = timeWindow, ecc_m = ecc_m)
crps_list_tmp[,,RR] <- crps_wrapper(ssh$mvppout, obs)
tmp <- eval_all_mult(mvpp_out = ssh$mvppout, obs = obs)
es_list_tmp[,RR] <- tmp$es
vs1_list_tmp[,RR] <- tmp$vs1
vs1w_list_tmp[,RR] <- tmp$vs1w
vs0_list_tmp[,RR] <- tmp$vs0
vs0w_list_tmp[,RR] <- tmp$vs0w
end_time <- Sys.time()
timing_list_tmp[RR] <- end_time - start_time
}
crps_list$ssh <- apply(crps_list_tmp, c(1,2), mean)
es_list$ssh <- apply(es_list_tmp, 1, mean)
vs1_list$ssh <- apply(vs1_list_tmp, 1, mean)
vs1w_list$ssh <- apply(vs1w_list_tmp, 1, mean)
vs0_list$ssh <- apply(vs0_list_tmp, 1, mean)
vs0w_list$ssh <- apply(vs0w_list_tmp, 1, mean)
timing_list$ssh <- apply(timing_list_tmp, 1, mean)
mvpp_list$ssh <- ssh$mvppout
print("GCA")
# GCA -> involves randomness -> repeat rand_rep times
es_list_tmp <- vs1_list_tmp <- vs1w_list_tmp <-
vs0_list_tmp <- vs0w_list_tmp <- matrix(NA, nrow = nout, ncol = rand_rep)
crps_list_tmp <- array(NA, dim = c(nout, d, rand_rep))
timing_list_tmp <- array(NA, dim = rand_rep)
for(RR in 1:rand_rep){
start_time <- Sys.time()
gca <- mvpp(method = "GCA", ensfc = ensfc, ensfc_init = ensfc_init,
obs = obs, obs_init = obs_init, postproc_out = pp_out, timeWindow = timeWindow, ecc_m = ecc_m, uvpp = uvpp)
.GlobalEnv$tt <- gca$mvppout
crps_list_tmp[,,RR] <- crps_wrapper(gca$mvppout, obs)
tmp <- eval_all_mult(mvpp_out = gca$mvppout, obs = obs)
es_list_tmp[,RR] <- tmp$es
vs1_list_tmp[,RR] <- tmp$vs1
vs1w_list_tmp[,RR] <- tmp$vs1w
vs0_list_tmp[,RR] <- tmp$vs0
vs0w_list_tmp[,RR] <- tmp$vs0w
end_time <- Sys.time()
timing_list_tmp[RR] <- end_time - start_time
}
crps_list$gca <- apply(crps_list_tmp, c(1,2), mean)
es_list$gca <- apply(es_list_tmp, 1, mean)
vs1_list$gca <- apply(vs1_list_tmp, 1, mean)
vs1w_list$gca <- apply(vs1w_list_tmp, 1, mean)
vs0_list$gca <- apply(vs0_list_tmp, 1, mean)
vs0w_list$gca <- apply(vs0w_list_tmp, 1, mean)
timing_list$gca <- apply(timing_list_tmp, 1, mean)
mvpp_list$gca <- gca$mvppout
# Archimedean copulas -> involves randomness -> repeat rand_rep times
for (method in c("Surv_Gumbel", "Clayton","Frank", "Gumbel")) {
print(method)
start_time <- Sys.time()
mvd <- mvpp(method = method, ensfc = ensfc, ensfc_init = ensfc_init,
obs = obs, obs_init = obs_init, postproc_out = pp_out, timeWindow = timeWindow, ecc_m = ecc_m, uvpp = uvpp)
chosenCopula_list[[method]] <- mvd$chosenCopula
good_rows <- !unname(apply(mvd$mvppout, MARGIN = 1, FUN = function(x) any(is.na(x))))
score_mvppout <- mvd$mvppout[good_rows,,]
score_obs <- obs[good_rows,]
crps_list[[method]][good_rows,] <- crps_wrapper(score_mvppout, score_obs)
tmp <- eval_all_mult(mvpp_out = score_mvppout, obs = score_obs)
es_list[[method]][good_rows] <- tmp$es
vs1_list[[method]][good_rows] <- tmp$vs1
vs1w_list[[method]][good_rows] <- tmp$vs1w
vs0_list[[method]][good_rows] <- tmp$vs0
vs0w_list[[method]][good_rows] <- tmp$vs0w
mvpp_list[[method]] <- mvd$mvppout
end_time <- Sys.time()
timing_list[[method]] <- end_time - start_time
}
# Seasonal copula MVPP
print("Seasonal")
start_time <- Sys.time()
mvd <- seasonal_copula(data, ensfc = ensfc, obs = obs, obs_init = obs_init, postproc_out = pp_out, ecc_m = ecc_m)
good_rows <- !unname(apply(mvd$mvppout, MARGIN = 1, FUN = function(x) any(is.na(x))))
score_mvppout <- mvd$mvppout[good_rows,,]
score_obs <- obs[good_rows,]
crps_list[["Seasonal"]][good_rows,] <- crps_wrapper(score_mvppout, score_obs)
tmp <- eval_all_mult(mvpp_out = score_mvppout, obs = score_obs)
es_list[["Seasonal"]][good_rows] <- tmp$es
vs1_list[["Seasonal"]][good_rows] <- tmp$vs1
vs1w_list[["Seasonal"]][good_rows] <- tmp$vs1w
vs0_list[["Seasonal"]][good_rows] <- tmp$vs0
vs0w_list[["Seasonal"]][good_rows] <- tmp$vs0w
mvpp_list[["Seasonal"]] <- mvd$mvppout
end_time <- Sys.time()
timing_list[["Seasonal"]] <- end_time - start_time
copula_df <- mvd$copula_df
print("Returning Output")
# return results, as a huge list
out <- list("crps_list" = crps_list, "es_list" = es_list, "vs1_list" = vs1_list,
"vs1w_list" = vs1w_list, "vs0_list" = vs0_list, "vs0w_list" = vs0w_list,
"timing_list" = timing_list, "mvpp_list" = mvpp_list, "chosenCopula_list" = chosenCopula_list,
"obs" = obs, "copula_df" = copula_df)
return(out)
}
trainingDays <- 365
saveDir <- "./../Data/Rdata_LAEF/"
res <- run_processing(data1, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_1", ".Rdata")
save(res, file = savename)
res <- run_processing(data2, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_2", ".Rdata")
save(res, file = savename)
res <- run_processing(data3, trainingDays, progress_ind = TRUE)
savename <- paste0(saveDir, "Res_group_3", ".Rdata")
save(res, file = savename)
load("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/Data/Rdata_LAEF/Res_group_1.Rdata")
View(res)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/processing code for simulation output/DM_TestStatistic_computation_data.R")
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/processing code for simulation output/DM_TestStatistic_computation_data.R")
View(dfmc)
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/processing code for simulation output/DM_TestStatistic_computation_data.R")
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/processing code for simulation output/DM_TestStatistic_computation_data.R")
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/reproducing results and figures/multivariate_data.R")
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/reproducing results and figures/multivariate_data.R")
source("C:/Users/20192042/OneDrive - TU Eindhoven/University/Bachelor/Year 3/BEP - BAM/Code/multiv_pp-master/reproducing results and figures/multivariate_data.R")
